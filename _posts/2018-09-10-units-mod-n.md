---
layout: post
title: The Multiplicative Structure of $\Bbb Z / n \Bbb Z$
use_math: true
---
<div style="display: none;">
$\newcommand{\ZZ}{\Bbb Z}
\newcommand{\ZZn}[1]{\ZZ / {#1} \ZZ}$
</div>

One of the most familiar rings is the ring of integers modulo $n$, often denoted $\ZZn{n}$. The additive structure is simple and obvious: $\ZZn{n}$ is cyclic, generated by $1$. In fact, every integer $a$ coprime to $n$ is a generator for this group; there are $\phi(n)$ such generators. The multiplicative structure, on the other hand, is far less apparent.

Elements with multiplicative inverses are called *units*, and they form a group under multiplication. We will denote the group of units in $\ZZn{n}$ as $U_n$. We know $U_n$ has $\phi(n)$ elements, but this doesn't pin down the group structure.

Examples:
 - $U_5 = \\{ 1, 2, 3, 4 \\}$ is cyclic, and $2$ is a generator
   - powers of $2$ are: $2^0 = 1$, $2^1 = 2$, $2^2 = 4$, $2^3 = 8 = 3$
 - $U_6 = \\{ 1, 5 \\}$ is cyclic, and $5$ is a generator
 - $U_8 = \\{ 1, 3, 5, 7 \\}$ is not cyclic; every element squares to $1$

Of particular interest are cases where $U_n$ is cyclic.

<!--more-->
---

The most powerful tool we have at our disposal is the Chinese Remainder Theorem, which (as a special case) says that, for $m$, $n$ coprime, the rings $\ZZn{m} \times \ZZn{n}$ and $\ZZn{mn}$ are isomorphic. This induces an isomorphism on the units as well (can you see why?).

This means that in order to understand $U_n$, we only need to understand $U_{p^k}$ for prime $p$.

We claim that $U_{p^k}$ is always cyclic for odd $p$, but for $p = 2$, only $\ZZn{2}$ and $\ZZn{4}$ are.

---

Let $p$ be an odd prime.

Of course, we start with the simplest case, $U_p$. Because $\ZZn{p}$ is a field, its multiplicative group is cyclic (see [here](https://math.stackexchange.com/a/59911/55540) for a slick proof).

It is tempting to use this as the base case for an induction on $k$, but for technical reasons, we'll need to address $k = 2$ specially.

TECHNICAL REASONS: assuming that our claim is true and that $U_{p^k}$ is cyclic, let's consider the number of generators as $k$ increases. Since the number of generators in a cyclic group of size $m$ is $\phi(m)$, we have:

| Group           | $U_p$       | $U_{p^2}$         | $U_{p^k}$, $k > 2$        |
|-----------------|:-----------:|:-----------------:|:-------------------------:|
| # of elements   | $p - 1$     | $p(p-1)$          | $p^{k-1} (p-1)$           |
| # of generators | $\phi(p-1)$ | $(p-1) \phi(p-1)$ | $p^{k-2} (p-1) \phi(p-1)$ |

When we jump from $k = 1$ to $k = 2$, the number of elements increases by a factor of $p$, but the number of generators only increases by $p - 1$. However, at all other stages, both the number of elements and generators increase by $p$. This suggests (but does not prove!) that every lift of a generator from $U_{p^k}$ to $U_{p^{k+1}}$ is a generator, but that we have to be more careful when lifting from $U_p$ to $U_{p^2}$.

---

From the evidence above, we suspect that if $g$ is a generator mod $p$, only $p-1$ of the $p$ possible lifts to $U_{p^2}$ will be generators. This suggests there is one "bad" lift for each generator.

Fortunately, we can find this bad lift explicitly: it's $g^p$.

We know that $g^p \equiv g \pmod{p}$, so $g^p$ really is a lift of $g$. And since $g^{p(p-1)} \equiv 1 \pmod{p^2}$, we know that the order of $g^p$ is too small to generate all of $U_{p^2}$.

If our hunch is true, then this is the *only* bad lift of $g$, and so we make the following claim:

**Claim**: if $a$ is not a multiple of $p$, then $g^p + ap$ generates $U_{p^2}$.

*Proof*: Since $g^p + ap \equiv g \pmod{p}$, it has order $p-1$ in $U_p$. This means its order in $U_{p^2}$ must be a multiple of $p-1$. Its order must also divide the size of the group, narrowing the possibilities to $p-1$ and $p(p-1)$. Thus, to prove that $g^p + ap$ is a generator, we just have to show it doesn't have order $p-1$.

Assume it does, and expand $1 \equiv (g^p + ap)^{p-1}$ by the binomial theorem:
\\[ 1 \equiv (g^p + ap)^{p-1} \equiv (g^p)^{p-1} + (p-1) (g^p)^{p-2} ap + \sum_{i = 2}^{p - 1} \binom{p - 1}{i} (g^p)^{p-1-i} (ap)^i \pmod{p^2} \\]

Every term in the big sum has two or more $p$s in it, so it gets killed, telling us that
\\[ 1 \equiv g^{p(p-1)} + (p-1) g^{p(p-2)} ap \pmod{p^2} \\]

Recalling that $g^{p(p-1)} \equiv 1$, we get:
\\[ 0 \equiv (p-1) g^{p(p-2)} ap \pmod{p^2} \\]

For this to be true, we would need to find a factor of $p$ in $(p-1) g^{p(p-2)} a$, but this is fruitless. By contradiction, $g^p + ap$ must have order $p(p-1)$ and thus generate $U_{p^2}$.

Note that there are $p-1$ choices of $a$, and so this corroborates our suspicion that every generator mod $p$ has $p-1$ good lifts and one bad lift mod $p^2$.

---

Now we're ready for the inductive step.

Let $g$ be a generator of $U_{p^k}$, $k \ge 2$. We claim it is also a generator for $U_{p^{k+1}}$.

As a generator, it has order $p^{k-1} (p-1)$ in $U_{p^k}$, and so its order in $U_{p^{k+1}}$ must be a multiple of that. This means it is either $p^{k-1} (p - 1)$ or $p^k (p - 1)$. We just need to show it isn't the former.

Consider $g^{p^{k-2} (p-1)}$. By Euler's theorem, $g^{p^{k-2} (p-1)} \equiv 1 \pmod{p^{k-1}}$. But it can't also be $1$ mod $p^k$, because $g$ is a generator and has order $p^{k-1} (p-1)$ there. So $g^{p^{k-2} (p-1)} = 1 + a p^{k-1}$ where $p \nmid a$.

Now we can expand $g^{p^{k-1} (p-1)}$ with this substitution and the binomial theorem:
\\[ g^{p^{k-1} (p-1)} = (g^{p^{k-2} (p-1)})^p = (1 + a p^{k-1})^p = 1 + p a p^{k-1} + \sum_{i = 2}^{p-1} \binom{p}{i} (a p^{k-1})^i + (a p^{k-1})^p \\]

Each term in the big sum has $1 + (k-1)i \ge 1 + 2(k-1) = 2k-1$ factors of $p$ in it, and so it is killed mod $p^{k+1}$ (recall $k \ge 2$). The last term has $(k-1)p \ge 3k-3$ factors of $p$, and so it likewise vanishes. So we are left with $g^{p^{k-1} (p-1)} \equiv 1 + a p^k \pmod{p^{k+1}}$, which shows that $g$ does not have order $p^{k-1} (p - 1)$. Thus, $g$ must be a generator mod $p^{k+1}$.

By induction, this shows that $U_{p^k}$ is cyclic for all $k$.

---

Note that the above argument *almost* works for $p = 2$; the base case goes through, and the inductive step fails only when $k = 2$, on the last term. If there were generators for $U_8$, then they would lift to generators for $U_{16}$, and those to $U_{32}$, and so on. But we just barely fail the jump from $k = 2$ to $k = 3$ (verify this yourself!), and this is why $p = 2$ is different from its odd peers.

Still though, we can modify our argument slightly to derive the structure of $U_{2^k}$ for $k \ge 3$. Since $U_8$ is non-cyclic, there is no chance for any higher $U_{2^k}$ to be cyclic. But we will show they're pretty darn close.

We will call $g$ a "near-generator" of $U_{2^k}$ if $g$ generates half the group, and multiplying by $-1$ gives the other half. Our base case is $U_8 = \\{ 1, 3, 5, 7 \\}$, for which $3$ and $5$ are near-generators.

Say that $g$ is a near-generator of $U_{2^k}$. We claim that it is also a near-generator of $U_{2^{k+1}}$.

As before, we show the possible orders for $g$, and eliminate all but one possibility. Since $g$ is a near-generator mod $2^k$, it has order $2^{k-2}$ in $U_{2^k}$. Thus its order in $U_{2^{k+1}}$ must be a multiple of $2^{k-2}$. This leaves possibilities $2^{k-2}$, $2^{k-1}$, and $2^k$. It cannot be $2^k$, because that would imply that $U_{2^{k+1}}$ is cyclic, and that is impossible (it has a non-cyclic quotient). So it remains to eliminate $2^{k-2}$.

A similar argument to the odd $p$ case can be used to tell us that $g^{2^{k-3}} = 1 + a 2^{k-1}$ for some $a$ not divisible by $2$. Then:
\\[ g^{2^{k-2}} = (g^{2^{k-3}})^2 = (1 + a 2^{k-1})^2 = 1 + 2 \cdot a 2^{k-1} + a^2 2^{2k-2} \\]

Taken mod $2^{k+1}$, this tells us that $g^{2^{k-2}} \equiv 1 + a 2^k \pmod{2^{k+1}}$, eliminating the possibility of $2^{k-2}$ as the order. Thus, $g$ must have order $2^{k-1}$ in $U_{2^{k+1}}$.

To show that $-1$ gives the rest of the group, it suffices to show that $-1$ is not in the half generated by $g$. But if $g^r \equiv -1 \pmod{2^{k+1}}$, then surely this would also be true mod $2^k$, and so this situation does not arise.

Therefore, for $k \ge 3$, $U_{2^k} = \\{ \pm g^r \mid r = 0, 1, \ldots 2^{k-2} - 1 \\} \cong \ZZn{2} \times \ZZn{2^{k-2}}$. The cases of $U_2$ and $U_4$ are easily computed to be the trivial group and $\ZZn{2}$, respectively.

---

Now we are finally ready to understand $U_n$ in general: factor $n$ into primes, and apply the results we learned above.

Specifically, we can answer the question of exactly when $U_n$ is cyclic.

If $n$ has two odd prime factors $p$ and $q$, then $n = p^k q^\ell n'$ with $n'$ coprime to $p$ and $q$. So $U_n \cong U_{p^k} \times U_{q^\ell} \times U_{n'}$. But the first two groups both have even size. So $U_{p^k} \times U_{q^\ell}$ isn't cyclic, and neither is $U_n$.

If $8$ divides $n$, then $n = 2^k m$ for some odd $m$ and some $k \ge 3$, and $U_n = U_{2^k} \times U_m$. But $U_{2^k}$ is not cyclic, and this also disqualifies $n$.

So we are left with $n = 1$, $2$, $4$, $p^k$, $2p^k$, and $4p^k$. The first three can be checked by hand; they're all cyclic. We showed earlier that $U_{p^k}$ is cyclic, and CRT tells us that $U_{2p^k} \cong U_2 \times U_{p^k}$ is too (note that $U_2$ is the trivial group). But $U_{4p^k} \cong U_4 \times U_{p^k}$, and both groups have even size, and so $U_{4p^k}$ is not cyclic.

---

To summarize:
 - $U_n$ is cyclic exactly when $n = 1$, $2$, $4$, $p^k$ or $2p^k$
 - $U_{p^k} \cong \ZZn{p^{k-1} (p-1)}$ for odd $p$
 - $U_{2^k} \cong \ZZn{2} \times \ZZn{2^{k-2}}$ for $k \ge 3$
 - lifting a generator always produces another generator, except potentially from $p$ to $p^2$ (but the "bad lift" is known explicitly)
