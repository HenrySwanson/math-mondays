<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta http-equiv='X-UA-Compatible' content='IE=edge'>
  <meta name='viewport' content='width=device-width, initial-scale=1.0'>

  <title>Math Mondays - Safes and Keys</title>

  <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link rel="stylesheet" type="text/css" href="https://mathmondays.com/theme/css/style.min.css?aa78b755" />

  <!-- RSS FEED -->
  <link href="https://mathmondays.com/feed.xml" type="application/atom+xml" rel="alternate"
    title="Math Mondays Atom Feed" />

  <!-- Favicon links -->
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">

  <!-- Plausible analytics script -->
  <script defer data-domain="mathmondays.com" src="https://plausible.mathmondays.com/js/script.js"></script>
</head>

<body>
  <header id="site-header-bar" class="color-bar">
    <div id="site-header" class="width-wrapper">
      <h1 id="header-sitename">Math Mondays</h1>

      <div id="header-navbar">
        <nav>
          <ul>
            <li><a href="https://mathmondays.com/">home</a></li>
            <li><a href="https://mathmondays.com/about">about</a></li>
            <li><a href="https://mathmondays.com/archives">archives</a></li>
            <li><a href="https://github.com/HenrySwanson/HenrySwanson.github.io/issues">feedback</a></li>
          </ul>
        </nav>

        <div id="social-icons-container">
          <!-- Values may be overridden by CSS, but at least they won't load huge at first -->
          <a href="mailto:henryswanson94@gmail.com" style="text-decoration: none;" title="email">
            <div class="svg-icon-box">
<svg viewBox="0 0 35 35" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em">
  <path d="m 22.04663,18.138401 12.174681,8.938025 V 6.5 Z M 0.778689,6.5 V 27.076426 L 12.95311,18.137149 Z M 17.5,22.484489 14.593302,19.706522 0.778689,28.5 H 34.221311 L 20.406373,19.706522 Z M 33.218033,6.5 H 1.781967 L 17.5,18.95493 Z m 0,0"></path>
</svg>            </div>
          </a>
          <a href="https://github.com/HenrySwanson" style="text-decoration: none;" title="github">
            <div class="svg-icon-box">
<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em">
<path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8C0 11.54 2.29 14.53 5.47 15.59C5.87 15.66 6.02 15.42 6.02 15.21C6.02 15.02 6.01 14.39 6.01 13.72C4 14.09 3.48 13.23 3.32 12.78C3.23 12.55 2.84 11.84 2.5 11.65C2.22 11.5 1.82 11.13 2.49 11.12C3.12 11.11 3.57 11.7 3.72 11.94C4.44 13.15 5.59 12.81 6.05 12.6C6.12 12.08 6.33 11.73 6.56 11.53C4.78 11.33 2.92 10.64 2.92 7.58C2.92 6.71 3.23 5.99 3.74 5.43C3.66 5.23 3.38 4.41 3.82 3.31C3.82 3.31 4.49 3.1 6.02 4.13C6.66 3.95 7.34 3.86 8.02 3.86C8.7 3.86 9.38 3.95 10.02 4.13C11.55 3.09 12.22 3.31 12.22 3.31C12.66 4.41 12.38 5.23 12.3 5.43C12.81 5.99 13.12 6.7 13.12 7.58C13.12 10.65 11.25 11.33 9.47 11.53C9.76 11.78 10.01 12.26 10.01 13.01C10.01 14.08 10 14.94 10 15.21C10 15.42 10.15 15.67 10.55 15.59C13.71 14.53 16 11.53 16 8C16 3.58 12.42 0 8 0Z"/>
</svg>            </div>
          </a>
          <a href="feed.xml" style="text-decoration: none;" title="rss">
            <div class="svg-icon-box">
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 448" width="1em" height="1em">
  <path
     d="m 128.081,383.9587 c 0,35.369 -28.672,64.041 -64.041,64.041 -35.369,0 -64.04,-28.672 -64.04,-64.041 0,-35.369 28.672,-64.041 64.041,-64.041 35.369,0 64.04,28.673 64.04,64.041 z m 175.66,47.25 C 295.387,276.6087 171.556,152.6217 16.791,144.2587 7.656,143.7647 0,151.1047 0,160.2527 v 48.069 c 0,8.415 6.49,15.472 14.887,16.018 111.832,7.284 201.473,96.702 208.772,208.772 0.547,8.397 7.604,14.887 16.018,14.887 h 48.069 c 9.149,0.001 16.489,-7.655 15.995,-16.79 z m 144.249,0.288 C 439.596,197.6767 251.465,8.4446954 16.503,0.00969543 7.473,-0.31430457 0,6.9806954 0,16.015695 v 48.068 c 0,8.625 6.835,15.645 15.453,15.999 191.179,7.839 344.627,161.316005 352.465,352.465005 0.353,8.618 7.373,15.453 15.999,15.453 h 48.068 c 9.034,-10e-4 16.329,-7.474 16.005,-16.504 z"
     id="path843" />
</svg>            </div>
          </a>
          <a href="https://stackexchange.com/users/2216552/henry-swanson" style="text-decoration: none;" title="stack-exchange">
            <div class="svg-icon-box">
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 93 93" width="1em" height="1em">
  <style
     id="style851">.st0{fill:#376db6}.st1{fill:#4ca2da}.st2{fill:#91d8f4}.st3{fill:#1e5397}</style>
  <path
     class="st0"
     d="M 9.1,40.5 H 83.9 V 55.9 H 9.1 Z"
     id="path853" />
  <path
     class="st1"
     d="M 9.1,20.6 H 83.9 V 36 H 9.1 Z"
     id="path855" />
  <path
     class="st2"
     d="M 72.2,0 H 21.1 c -6.6,0 -12,5.5 -12,12.3 v 4 h 74.8 v -4 C 83.9,5.5 78.7,0 72.2,0 Z"
     id="path857" />
  <path
     class="st3"
     d="m 8.85,60.3 v 4 c 0,6.8 5.4,12.3 12,12.3 h 32 v 16.3 l 15.8,-16.3 h 3.5 c 6.6,0 12,-5.5 12,-12.3 v -4 z"
     id="path859" />
</svg>            </div>
          </a>
        </div>
      </div>
    </div>
  </header>

  <main class="width-wrapper">
<article>
  
  <header>
    <h1 class="article-title">
      <a href="https://mathmondays.com/safes-and-keys" title="Permalink to Safes and Keys">Safes and Keys</a>
    </h1>
    <div class="article-date">November 16, 2018</div>

    <div class="article-tags">
      tags:
      <a href="https://mathmondays.com/tag/puzzles">puzzles</a>
      <a href="https://mathmondays.com/tag/combinatorics">combinatorics</a>
    </div>
  </header>

  <section><p>Here&rsquo;s a few similar puzzles with a common story:</p>
<blockquote>
<p>I have <em>n</em> safes, each one with a unique key that opens it. Unfortunately, some prankster snuck into my office last night and stole my key ring. It seems they&rsquo;ve randomly put the keys inside the safes (one key per safe), and locked them.</p>
</blockquote>
<p>We&rsquo;ll play around with a few different conditions and see what chances we have of getting all safes unlocked, and at what cost.</p>


<hr>
<p><strong>1) The prankster was a bit sloppy, and forgot to lock one of the safes. What is the probability I can unlock all of my safes?</strong></p>
<p>The key observation here, as with the subsequent problems, is to consider the arrangement of keys and safes as a permutation. Label the safes and keys <span class="math">\(1\)</span> to <span class="math">\(n\)</span>, and define <span class="math">\(\pi(i)\)</span> to be the number of the key inside the <span class="math">\(i\)</span>th safe. So, if we have key <span class="math">\(1\)</span>, we unlock safe <span class="math">\(1\)</span> to reveal key <span class="math">\(\pi(1)\)</span>.</p>
<p>Under this interpretation, key <span class="math">\(i\)</span> lets us unlock all safes in the cycle containing <span class="math">\(i\)</span>; we open a safe, find a new key, track down the new safe, and repeat until we end up where we started. So, we want to know the probability that a randomly chosen permutation has exactly one cycle.</p>
<p>This isn&rsquo;t too hard; we can count the number of one-cycle permutations in a straightforward way. Given a permutation of one cycle, we start with element <span class="math">\(1\)</span>, we write out <span class="math">\(\pi(1)\)</span>, <span class="math">\(\pi(\pi(1))\)</span>, etc, until we loop back to <span class="math">\(1\)</span>. This produces an ordered list of <span class="math">\(n\)</span> numbers, starting with <span class="math">\(1\)</span>, and this uniquely determines the cycle. There are <span class="math">\((n-1)!\)</span> such lists, and so the probability of having exactly one cycle is <span class="math">\((n-1)!/n! = 1/n\)</span></p>
<hr>
<p><strong>2) Say the prankster is sloppier, and leaves k safes unlocked. Now what is my probability of success?</strong></p>
<p>This one requires a little more thought. It&rsquo;s tempting to consider permutations with <span class="math">\(k\)</span> cycles, but that&rsquo;s not quite right. If there&rsquo;s only one cycle, we&rsquo;re sure to succeed, and furthermore, even if there are <span class="math">\(k\)</span> cycles, our success isn&rsquo;t guaranteed: we could pick two safes in the same cycle.</p>
<p>By symmetry, label our safes so that we&rsquo;ve picked safes <span class="math">\(1\)</span>, <span class="math">\(2\)</span>, &hellip;, <span class="math">\(k\)</span>. We&rsquo;d like to know how many permutations have a cycle that completely avoid <span class="math">\(1\)</span> through <span class="math">\(k\)</span>. If, and only if, such a cycle is present, we fail to unlock all the safes.</p>
<p>Let <span class="math">\(a_i\)</span> be the number of &ldquo;good&rdquo; permutations when there are <span class="math">\(i\)</span> safes. We will express <span class="math">\(a_n\)</span> in terms of smaller <span class="math">\(a_i\)</span>s, and solve the resulting recurrence relation.</p>
<p>Given a permutation <span class="math">\(\pi\)</span>, we can split the set <span class="math">\(\{ 1, \ldots n \}\)</span> into two parts: those that have cycles intersecting <span class="math">\(\{ 1, \ldots, k \}\)</span>, and those that do not. (It may help to think of these sets as &ldquo;reachable&rdquo; and &ldquo;unreachable&rdquo; safes, respectively). Since <span class="math">\(\pi\)</span> never sends a reachable safe to an unreachable one, or vice versa, it induces permutations on both these sets. Also, knowing both these subpermutations, we can reconstruct <span class="math">\(\pi\)</span>. So, let&rsquo;s count how many possible permutations there are on the reachable and unreachable sets.</p>
<p>If there are <span class="math">\(r\)</span> reachable safes, then there are <span class="math">\(a_r\)</span> possible permutations induced on the reachable set, and <span class="math">\((n-r)!\)</span> induced on the unreachable one. (The reason we don&rsquo;t get the full <span class="math">\(r!\)</span> on the reachable set is that some permutations would leave a safe unreachable, when it&rsquo;s supposed to be reachable.) Furthermore, we have a choice of <em>which</em> safes are reachable. The first <span class="math">\(k\)</span> safes must be reachable, so beyond that, we have <span class="math">\(\binom{n-k}{r-k}\)</span> more choices to make. Our recurrence relation is then:
</p>
<div class="math">$$ n! = \sum_{r = k}^n \binom{n-k}{r-k} a_r (n-r)! = \sum_{r = k}^n a_r \frac{(n-k)!}{(r-k)!} $$</div>
<p>Since <span class="math">\((n-k)!\)</span> doesn&rsquo;t depend on <span class="math">\(r\)</span>, we can pull it out to get a neater-looking form:
</p>
<div class="math">$$ \frac{n!}{(n-k)!} = \sum_{r=k}^n \frac{a_r}{(r-k)!} $$</div>
<p>Now <span class="math">\(n\)</span> only shows up as an index, not anywhere in the summand. This lets us collapse our sum; take this term, and subtract it from the corresponding one for <span class="math">\(n-1\)</span>:
</p>
<div class="math">$$
\begin{align*}
\frac{n!}{(n-k)!} - \frac{(n-1)!}{(n-1-k)!} &amp;= \left( \sum_{r=k}^n \frac{a_r}{(r-k)!} \right) - \left( \sum_{r=k}^{n-1} \frac{a_r}{(r-k)!} \right) \\
\frac{n!}{(n-k)!} - \frac{(n-1)!}{(n-1-k)!} &amp;= \frac{a_n}{(n-k)!} \\
n! - (n-1)!(n-k) &amp;= a_n \\
k \cdot (n-1)! &amp;= a_n
\end{align*}
$$</div>
<p>So there&rsquo;s <span class="math">\(k \cdot (n-1)!\)</span> permutations in which we win. Since there&rsquo;s <span class="math">\(n!\)</span> total, this gives our probability of success at <span class="math">\(k/n\)</span>.</p>
<hr>
<p><strong>3) If the prankster is careful, and remembers to lock all the safes, then I have no choice but to break some of them open. What&rsquo;s the expected number of safes I have to crack?</strong></p>
<p>This one&rsquo;s much easier than 2). The question here is just &ldquo;how many cycles are there in a random permutation&rdquo;, and <a href="/linearity-expectation">from a previous post</a>, we know that&rsquo;s <span class="math">\(H_n\)</span>, the <span class="math">\(n\)</span>th harmonic number.</p>
<hr>
<p><strong>4) Putting it all together: if we start with <span class="math">\(k\)</span> safes unlocked, what&rsquo;s the expected number of safes I have to crack open?</strong></p>
<p>I haven&rsquo;t actually put this one on solid ground yet! It&rsquo;s not coming out pretty.</p>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script></section>

  <footer>

    <!-- Generate the view counter -->
    <div style="text-align:right">
      <img src="https://visitor-badge.glitch.me/badge?page_id=math-mondays-safes-and-keys&left_color=%235c6679&right_color=%23e86655" style="display:inline">
    </div>

  </footer>

</article>
  </main>

  <footer id="site-footer-bar" class="color-bar">
    <div id="site-footer" class="width-wrapper">
      <span>generated by <a href="https://getpelican.com">Pelican</a></span>
      ·
      <span>cookie-less analytics via <a href="https://plausible.io/">Plausible</a></span>
      ·
      <span>see the <a href="https://github.com/HenrySwanson/HenrySwanson.github.io">source code</a></span>
    </div>
  </footer>

</body>

</html>